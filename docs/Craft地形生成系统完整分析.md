# Crafté¡¹ç›®åœ°å½¢ç”Ÿæˆç³»ç»Ÿå®Œæ•´åˆ†æ

> ğŸ® **åŸºäºCraftå¼€æºé¡¹ç›®çš„åœ°å½¢ç”Ÿæˆç³»ç»Ÿæ·±åº¦æŠ€æœ¯è§£æ**  
> ğŸ“Š **åŒ…å«å®Œæ•´çš„æ•°å­¦æ¨¡å‹ã€ç®—æ³•å®ç°å’Œæ€§èƒ½ä¼˜åŒ–ç­–ç•¥**  
> ğŸ› ï¸ **æä¾›å®ç”¨çš„å‚æ•°è°ƒä¼˜æŒ‡å—å’Œå®šåˆ¶åŒ–æ–¹æ¡ˆ**

## ğŸ“‹ ç›®å½•
- [1. ç³»ç»Ÿæ¦‚è¿°](#1-ç³»ç»Ÿæ¦‚è¿°)
- [2. å™ªå£°ç®—æ³•æ ¸å¿ƒ](#2-å™ªå£°ç®—æ³•æ ¸å¿ƒ)
- [3. ç§å­ç³»ç»Ÿæœºåˆ¶](#3-ç§å­ç³»ç»Ÿæœºåˆ¶)
- [4. åœ°å½¢ç”Ÿæˆæ•°å­¦æ¨¡å‹](#4-åœ°å½¢ç”Ÿæˆæ•°å­¦æ¨¡å‹)
- [5. ç½®æ¢è¡¨PERMè¯¦è§£](#5-ç½®æ¢è¡¨permè¯¦è§£)
- [6. ç”Ÿç‰©ç¾¤è½ç”Ÿæˆç®—æ³•](#6-ç”Ÿç‰©ç¾¤è½ç”Ÿæˆç®—æ³•)
- [7. è‡ªç„¶æ€§å®ç°åŸç†](#7-è‡ªç„¶æ€§å®ç°åŸç†)
- [8. ç³»ç»Ÿå‚æ•°è°ƒä¼˜](#8-ç³»ç»Ÿå‚æ•°è°ƒä¼˜)
- [9. åœ°å½¢ä¿®æ”¹ä¸å®šåˆ¶](#9-åœ°å½¢ä¿®æ”¹ä¸å®šåˆ¶)
- [10. æ€§èƒ½ä¼˜åŒ–ç­–ç•¥](#10-æ€§èƒ½ä¼˜åŒ–ç­–ç•¥)
- [11. å®è·µåº”ç”¨æ¡ˆä¾‹](#11-å®è·µåº”ç”¨æ¡ˆä¾‹)

---

## 1. ç³»ç»Ÿæ¦‚è¿°

### 1.1 æ¶æ„æ€»è§ˆ

Crafté¡¹ç›®é‡‡ç”¨åŸºäº**Simplexå™ªå£°**çš„ç¨‹åºåŒ–åœ°å½¢ç”Ÿæˆç³»ç»Ÿï¼Œé€šè¿‡å¤šå±‚å™ªå£°å åŠ å’Œæ•°å­¦å˜æ¢ï¼Œå®ç°äº†è‡ªç„¶ã€è¿ç»­ä¸”å…·æœ‰ä¸°å¯Œç»†èŠ‚çš„3Dåœ°å½¢ä¸–ç•Œã€‚

```mermaid
graph TD
    A["Craftåœ°å½¢ç”Ÿæˆç³»ç»Ÿæ¶æ„"] --> B["å™ªå£°å¼•æ“å±‚"]
    A --> C["åœ°å½¢ç”Ÿæˆå±‚"]
    A --> D["ç”Ÿç‰©ç¾¤è½å±‚"]
    A --> E["æ¸²æŸ“ä¼˜åŒ–å±‚"]
    
    B --> B1["Simplex 2Då™ªå£°"]
    B --> B2["Simplex 3Då™ªå£°"]
    B --> B3["PERMç½®æ¢è¡¨"]
    B --> B4["æ¢¯åº¦å‘é‡è¡¨"]
    
    C --> C1["åŒå±‚å™ªå£°ç³»ç»Ÿ"]
    C --> C2["é«˜åº¦è®¡ç®—"]
    C --> C3["æµ·é™†åˆ†å¸ƒ"]
    C --> C4["åœ°å½¢åˆ†ç±»"]
    
    C1 --> C1A["ä¸»åœ°å½¢å™ªå£° f(x,z)"]
    C1 --> C1B["é«˜åº¦è°ƒåˆ¶å™ªå£° g(x,z)"]
    
    D --> D1["æ¤ç‰©ç”Ÿæˆ"]
    D --> D2["æ ‘æœ¨ç”Ÿæˆ"]
    D --> D3["äº‘æœµç”Ÿæˆ"]
    
    D1 --> D1A["è‰åœ°åˆ†å¸ƒ"]
    D1 --> D1B["èŠ±æœµåˆ†å¸ƒ"]
    
    E --> E1["åŒºå—ç¼“å­˜"]
    E --> E2["å¤šçº¿ç¨‹ç”Ÿæˆ"]
    E --> E3["å†…å­˜æ± ç®¡ç†"]
```

**æ ¸å¿ƒç»„ä»¶ï¼š**
- **å™ªå£°å¼•æ“**: åŸºäºCasey Duncançš„noiseåº“å®ç°
- **åœ°å½¢ç”Ÿæˆå™¨**: `src/world.c`ä¸­çš„æ ¸å¿ƒç®—æ³•
- **ç§å­ç®¡ç†**: Pythonå±‚é¢çš„ç§å­æ§åˆ¶ç³»ç»Ÿ
- **ç”Ÿç‰©ç¾¤è½**: æ¤ç‰©ã€æ ‘æœ¨çš„ç¨‹åºåŒ–åˆ†å¸ƒ

**æŠ€æœ¯ç‰¹ç‚¹ï¼š**
- âœ… æ— é™ä¸–ç•Œç”Ÿæˆ
- âœ… ç¡®å®šæ€§è¾“å‡ºï¼ˆç›¸åŒç§å­äº§ç”Ÿç›¸åŒåœ°å½¢ï¼‰
- âœ… å®æ—¶åŒºå—ç”Ÿæˆ
- âœ… è‡ªç„¶çš„åœ°å½¢è¿‡æ¸¡
- âœ… ä¸°å¯Œçš„ç”Ÿç‰©ç¾¤è½

### 1.2 æ–‡ä»¶ç»“æ„

```
Craft/
â”œâ”€â”€ deps/noise/          # å™ªå£°ç®—æ³•åº“
â”‚   â”œâ”€â”€ noise.h         # å™ªå£°å‡½æ•°å£°æ˜
â”‚   â””â”€â”€ noise.c         # Simplexå™ªå£°å®ç°
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ world.h         # ä¸–ç•Œç”Ÿæˆæ¥å£
â”‚   â”œâ”€â”€ world.c         # åœ°å½¢ç”Ÿæˆæ ¸å¿ƒé€»è¾‘
â”‚   â””â”€â”€ config.h        # é…ç½®å‚æ•°
â”œâ”€â”€ world.py            # PythonåŒ…è£…å±‚
â””â”€â”€ server.py           # æœåŠ¡å™¨ç«¯ä¸–ç•Œç®¡ç†
```

---

## 2. å™ªå£°ç®—æ³•æ ¸å¿ƒ

### 2.1 Simplexå™ªå£°åŸç†

Simplexå™ªå£°æ˜¯Perlinå™ªå£°çš„æ”¹è¿›ç‰ˆæœ¬ï¼Œç”±Ken Perlinäº2001å¹´æå‡ºã€‚ç›¸æ¯”ä¼ ç»ŸPerlinå™ªå£°ï¼Œå…·æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š

**æ•°å­¦åŸºç¡€ï¼š**
- **ç»´åº¦å¤æ‚åº¦**: O(nÂ²) â†’ O(n)
- **æ¢¯åº¦å‘é‡**: ä½¿ç”¨å•çº¯å½¢ç½‘æ ¼è€Œéç«‹æ–¹ç½‘æ ¼
- **å„å‘åŒæ€§**: åœ¨æ‰€æœ‰æ–¹å‘ä¸Šå…·æœ‰ç›¸åŒçš„ç»Ÿè®¡ç‰¹æ€§
- **æ— æ–¹å‘æ€§åå·®**: é¿å…äº†ä¼ ç»Ÿå™ªå£°çš„è½´å‘åå·®

### 2.2 æ ¸å¿ƒç®—æ³•å®ç°

**2D Simplexå™ªå£°å‡½æ•°ï¼š**
```c
float noise2(float x, float y) {
    // 1. åæ ‡å˜æ¢åˆ°å•çº¯å½¢ç½‘æ ¼
    float s = (x + y) * F2;  // F2 = 0.366...
    float i = floorf(x + s);
    float j = floorf(y + s);
    float t = (i + j) * G2;  // G2 = 0.211...
    
    // 2. è®¡ç®—ä¸‰ä¸ªé¡¶ç‚¹çš„è´¡çŒ®
    float xx[3], yy[3], f[3];
    float noise[3] = {0.0f, 0.0f, 0.0f};
    
    // 3. é€‰æ‹©æ¢¯åº¦å‘é‡
    int I = (int) i & 255;
    int J = (int) j & 255;
    int g[3];
    g[0] = PERM[I + PERM[J]] % 12;
    g[1] = PERM[I + i1 + PERM[J + j1]] % 12;
    g[2] = PERM[I + 1 + PERM[J + 1]] % 12;
    
    // 4. è®¡ç®—æœ€ç»ˆå™ªå£°å€¼
    for (int c = 0; c <= 2; c++) {
        if (f[c] > 0) {
            noise[c] = f[c] * f[c] * f[c] * f[c] *
                (GRAD3[g[c]][0] * xx[c] + GRAD3[g[c]][1] * yy[c]);
        }
    }
    
    return (noise[0] + noise[1] + noise[2]) * 70.0f;
}
```

**å¤šå±‚å™ªå£°å åŠ ï¼ˆFractal Brownian Motionï¼‰ï¼š**
```c
float simplex2(float x, float y, int octaves, float persistence, float lacunarity) {
    float freq = 1.0f;
    float amp = 1.0f;
    float max = 1.0f;
    float total = noise2(x, y);
    
    for (int i = 1; i < octaves; i++) {
        freq *= lacunarity;    // é¢‘ç‡é€’å¢
        amp *= persistence;    // æŒ¯å¹…é€’å‡
        max += amp;
        total += noise2(x * freq, y * freq) * amp;
    }
    
    return (1 + total / max) / 2;  // å½’ä¸€åŒ–åˆ° [0,1]
}
```

### 2.3 å™ªå£°å‚æ•°å½±å“åˆ†æ

| å‚æ•° | ä½œç”¨ | å–å€¼èŒƒå›´ | è§†è§‰æ•ˆæœ |
|------|------|----------|----------|
| `octaves` | ç»†èŠ‚å±‚æ¬¡æ•° | 1-8 | è¶Šå¤§è¶Šç»†è…»ï¼Œæ€§èƒ½å¼€é”€è¶Šå¤§ |
| `persistence` | é«˜é¢‘æŒ¯å¹…è¡°å‡ | 0.1-0.9 | è¶Šå°è¶Šå¹³æ»‘ï¼Œè¶Šå¤§è¶Šç²—ç³™ |
| `lacunarity` | é¢‘ç‡å¢é•¿å€æ•° | 1.5-3.0 | é€šå¸¸å–2.0ï¼Œæ§åˆ¶ç»†èŠ‚åˆ†å¸ƒ |
| `frequency` | åŸºç¡€é¢‘ç‡ | 0.001-0.1 | è¶Šå°ç‰¹å¾å°ºåº¦è¶Šå¤§ |

---

## 3. ç§å­ç³»ç»Ÿæœºåˆ¶

### 3.1 ç§å­ä¼ é€’é“¾è·¯

```mermaid
flowchart TD
    A["ç¨‹åºå¯åŠ¨"] --> B{"è¿è¡Œæ¨¡å¼é€‰æ‹©"}
    
    B -->|æœåŠ¡å™¨æ¨¡å¼| C["server.py main()"]
    B -->|å®¢æˆ·ç«¯ç¦»çº¿| D["main.cç›´æ¥è°ƒç”¨"]
    
    C --> E["Model(seed=None)"]
    E --> F["World(seed=None)"]
    F --> G["åŒºå—è¯·æ±‚ create_chunk(p,q)"]
    
    G --> H{"self.seedæ£€æŸ¥"}
    H -->|æ˜¯None| I["ä¸è°ƒç”¨seed()"]
    H -->|æœ‰å…·ä½“å€¼| J["dll_seed(self.seed)"]
    
    J --> K["Cåº“ seed()å‡½æ•°"]
    K --> L["srand(seed)åˆå§‹åŒ–"]
    K --> M["é‡æ–°æ´—ç‰ŒPERM[256]"]
    
    I --> N["ä½¿ç”¨é»˜è®¤PERMè¡¨"]
    M --> O["ä½¿ç”¨æ´—ç‰ŒåPERMè¡¨"]
    
    N --> P["å›ºå®šåœ°å½¢æ¨¡å¼<br/>æ¯æ¬¡è¿è¡Œç›¸åŒ"]
    O --> Q["å¯å˜åœ°å½¢æ¨¡å¼<br/>ç§å­å†³å®šæ¨¡å¼"]
    
    D --> R["srand(time(NULL))"]
    R --> S["ç›´æ¥è°ƒç”¨create_world()"]
    S --> T["éšæœºåœ°å½¢<br/>æ¯æ¬¡å¯åŠ¨ä¸åŒ"]
    
    style P fill:#ffcdd2
    style Q fill:#c8e6c9
    style T fill:#e1f5fe
```

```mermaid
flowchart TD
    A["ç¨‹åºå¯åŠ¨"] --> B{"è¿è¡Œæ¨¡å¼"}
    B -->|æœåŠ¡å™¨æ¨¡å¼| C["server.py"]
    B -->|å®¢æˆ·ç«¯æ¨¡å¼| D["main.c"]
    
    C --> E["Model(seed=None)"]
    E --> F["World(seed=None)"]
    F --> G["create_chunk()"]
    G --> H{"self.seedæ£€æŸ¥"}
    
    H -->|None| I["ä½¿ç”¨é»˜è®¤PERMè¡¨"]
    H -->|æœ‰å€¼| J["dll_seed(seed)"]
    
    J --> K["Cåº“seed()å‡½æ•°"]
    K --> L["srand(seed)"]
    K --> M["é‡æ–°æ´—ç‰ŒPERMè¡¨"]
    
    I --> N["å›ºå®šåœ°å½¢æ¨¡å¼"]
    M --> O["å¯å˜åœ°å½¢æ¨¡å¼"]
    
    D --> P["srand(time(NULL))"]
    P --> Q["create_world()ç›´è°ƒç”¨"]
```

### 3.2 ç§å­å½±å“èŒƒå›´

**ç§å­ç›´æ¥å½±å“ï¼š**
- âœ… åœ°å½¢é«˜åº¦åˆ†å¸ƒ
- âœ… æ¤ç‰©ç”Ÿæˆä½ç½®
- âœ… æ ‘æœ¨åˆ†å¸ƒæ¨¡å¼
- âœ… äº‘æœµç”Ÿæˆä½ç½®

**ç§å­ä¸å½±å“ï¼š**
- âŒ æ–¹å—çº¹ç†è´´å›¾
- âŒ å…‰ç…§è®¡ç®—ç»“æœ
- âŒ ç©å®¶å»ºé€ çš„ç»“æ„
- âŒ åŸºç¡€ç‰©ç†è§„åˆ™

### 3.3 PERMç½®æ¢è¡¨æœºåˆ¶

**Fisher-Yatesæ´—ç‰Œç®—æ³•ï¼š**
```c
void seed(unsigned int x) {
    srand(x);
    
    // 1. åˆå§‹åŒ–ä¸ºé¡ºåºæ•°ç»„
    for (int i = 0; i < 256; i++) {
        PERM[i] = i;
    }
    
    // 2. Fisher-Yatesæ´—ç‰Œ
    for (int i = 255; i > 0; i--) {
        int j = rand() % (i + 1);  // ç®€åŒ–ç‰ˆæœ¬
        // äº¤æ¢ PERM[i] å’Œ PERM[j]
        unsigned char temp = PERM[i];
        PERM[i] = PERM[j];
        PERM[j] = temp;
    }
    
    // 3. å¤åˆ¶åˆ°é«˜ä½ä»¥é¿å…è¾¹ç•Œæ£€æŸ¥
    memcpy(PERM + 256, PERM, 256);
}
```

**PERMè¡¨çš„ä½œç”¨æœºåˆ¶ï¼š**
- **ä¼ªéšæœºæ€§**: å°†è§„å¾‹åæ ‡æ˜ å°„ä¸ºä¼ªéšæœºæ¢¯åº¦ç´¢å¼•
- **ç©ºé—´è¿ç»­æ€§**: ç›¸é‚»ä½ç½®äº§ç”Ÿç›¸å…³ä½†ä¸åŒçš„å€¼
- **ç¡®å®šæ€§**: ç›¸åŒç§å­æ€»æ˜¯äº§ç”Ÿç›¸åŒçš„PERMæ’åˆ—
- **å‘¨æœŸæ€§é¿å…**: é˜²æ­¢å™ªå£°å‡ºç°æ˜æ˜¾é‡å¤æ¨¡å¼

---

## 4. åœ°å½¢ç”Ÿæˆæ•°å­¦æ¨¡å‹

### 4.1 åŒå±‚å™ªå£°ç³»ç»Ÿ

Crafté‡‡ç”¨**åŒå±‚å™ªå£°**æ§åˆ¶åœ°å½¢é«˜åº¦ï¼š

```mermaid
graph TD
    A["åœ°å½¢é«˜åº¦è®¡ç®—ç³»ç»Ÿ"] --> B["ä¸»åœ°å½¢å™ªå£° f"]
    A --> C["é«˜åº¦è°ƒåˆ¶å™ªå£° g"]
    
    B --> B1["simplex2(x*0.01, z*0.01, 4, 0.5, 2)"]
    B --> B2["æ§åˆ¶ç›¸å¯¹é«˜åº¦å˜åŒ–"]
    B --> B3["è¾“å‡ºèŒƒå›´: [0, 1]"]
    
    C --> C1["simplex2(-x*0.01, -z*0.01, 2, 0.9, 2)"]
    C --> C2["æ§åˆ¶ç»å¯¹é«˜åº¦èŒƒå›´"]
    C --> C3["è¾“å‡ºèŒƒå›´: [0, 1]"]
    
    B3 --> D["é«˜åº¦åˆæˆ"]
    C3 --> D
    
    D --> E["mh = g * 32 + 16<br/>æœ€å¤§é«˜åº¦[16, 48]"]
    E --> F["h = f * mh<br/>å®é™…é«˜åº¦[0, mh]"]
    
    F --> G{"h <= 12?"}
    G -->|æ˜¯| H["æµ·æ´‹åŒºåŸŸ<br/>h = 12, w = 2(æ²™å­)"]
    G -->|å¦| I["é™†åœ°åŒºåŸŸ<br/>w = 1(è‰åœ°)"]
    
    style H fill:#e3f2fd
    style I fill:#e8f5e8
```

```c
// ä¸»åœ°å½¢å™ªå£° - æ§åˆ¶ç›¸å¯¹é«˜åº¦å˜åŒ–
float f = simplex2(x * 0.01, z * 0.01, 4, 0.5, 2);

// é«˜åº¦è°ƒåˆ¶å™ªå£° - æ§åˆ¶ç»å¯¹é«˜åº¦èŒƒå›´
float g = simplex2(-x * 0.01, -z * 0.01, 2, 0.9, 2);

// æœ€ç»ˆé«˜åº¦è®¡ç®—
int mh = g * 32 + 16;  // æœ€å¤§é«˜åº¦èŒƒå›´ [16, 48]
int h = f * mh;        // å®é™…é«˜åº¦ [0, mh]
```

### 4.2 åœ°å½¢é«˜åº¦ç»Ÿè®¡åˆ†æ

**æ¦‚ç‡åˆ†å¸ƒç‰¹å¾ï¼š**

å‡è®¾ f, g ~ Uniform[0,1]ï¼ˆè¿‘ä¼¼ï¼‰ï¼Œåˆ™ï¼š

| åœ°å½¢ç±»å‹ | é«˜åº¦èŒƒå›´ | æ¦‚ç‡åˆ†å¸ƒ | å æ¯”ä¼°ç®— |
|----------|----------|----------|----------|
| **æµ·æ´‹** | h â‰¤ 12 | P(h â‰¤ 12) | â‰ˆ 25% |
| **æµ·æ»©** | 12 < h â‰¤ 16 | P(12 < h â‰¤ 16) | â‰ˆ 10% |
| **å¹³åŸ** | 16 < h â‰¤ 28 | P(16 < h â‰¤ 28) | â‰ˆ 40% |
| **ä¸˜é™µ** | 28 < h â‰¤ 40 | P(28 < h â‰¤ 40) | â‰ˆ 20% |
| **å±±åœ°** | h > 40 | P(h > 40) | â‰ˆ 5% |

### 4.3 æµ·é™†åˆ†å¸ƒæœºåˆ¶

**æµ·å¹³é¢è®¾å®šï¼š**
```c
int t = 12;  // æµ·å¹³é¢é«˜åº¦
if (h <= t) {
    h = t;   // å¼ºåˆ¶æå‡åˆ°æµ·å¹³é¢
    w = 2;   // æ”¹ä¸ºæ²™å­æ–¹å—
}
```

**åœ°ç†æ„ä¹‰ï¼š**
- **æµ·å¹³é¢**: 12æ ¼é«˜åº¦ä½œä¸ºåŸºå‡†æµ·å¹³é¢
- **é™†åœ°ä¿è¯**: æ‰€æœ‰é™†åœ°è‡³å°‘é«˜äºæµ·å¹³é¢
- **æµ·æ´‹æ¯”ä¾‹**: çº¦25%çš„é¢ç§¯ä¸ºæµ·æ´‹
- **æµ·å²¸çº¿**: è‡ªç„¶å½¢æˆå¤æ‚çš„æµ·å²¸çº¿è½®å»“

### 4.4 åˆ†å½¢ç»´æ•°è®¡ç®—

**ç†è®ºåˆ†å½¢ç»´æ•°ï¼š**
```
D = 3 - H = 3 - logâ‚‚(persistence) / logâ‚‚(lacunarity)
D = 3 - logâ‚‚(0.5) / logâ‚‚(2) = 3 - (-1) / 1 = 2.5
```

**å®é™…æ„ä¹‰ï¼š**
- **D â‰ˆ 2.5**: ä»‹äºå¹³é¢(D=2)å’Œä½“ç§¯(D=3)ä¹‹é—´
- **è‡ªç„¶å¯¹åº”**: çœŸå®åœ°å½¢åˆ†ç»´çº¦2.1-2.3ï¼Œæ¥è¿‘è‡ªç„¶
- **è§†è§‰æ•ˆæœ**: äº§ç”Ÿä¸°å¯Œè€Œä¸è¿‡åº¦å¤æ‚çš„åœ°å½¢ç»†èŠ‚

---

## 5. ç½®æ¢è¡¨PERMè¯¦è§£

### 5.1 PERMè¡¨çš„æ•°æ®ç»“æ„

**å­˜å‚¨æ ¼å¼ï¼š**
```c
static unsigned char PERM[512] = {
    // å‰256ä¸ªï¼šæ´—ç‰Œåçš„0-255æ’åˆ—
    151, 160, 137, 91, 90, 15, 131, 13, ...
    
    // å256ä¸ªï¼šå‰256ä¸ªçš„å®Œå…¨å¤åˆ¶ï¼ˆé¿å…è¾¹ç•Œæ£€æŸ¥ï¼‰
    151, 160, 137, 91, 90, 15, 131, 13, ...
};
```

### 5.2 æ¢¯åº¦å‘é‡é€‰æ‹©æœºåˆ¶

**æ¢¯åº¦è¡¨å®šä¹‰ï¼š**
```c
const static float GRAD3[16][3] = {
    { 1, 1, 0}, {-1, 1, 0}, { 1,-1, 0}, {-1,-1, 0}, 
    { 1, 0, 1}, {-1, 0, 1}, { 1, 0,-1}, {-1, 0,-1}, 
    { 0, 1, 1}, { 0,-1, 1}, { 0, 1,-1}, { 0,-1,-1},
    { 1, 0,-1}, {-1, 0,-1}, { 0,-1, 1}, { 0, 1, 1}
};
```

**é€‰æ‹©è¿‡ç¨‹ï¼š**
1. **åæ ‡ç½‘æ ¼åŒ–**: (x,y) â†’ ç½‘æ ¼ç´¢å¼•(I,J)
2. **PERMæŸ¥è¡¨**: I,J â†’ PERM[I + PERM[J]]
3. **æ¨¡è¿ç®—**: PERMå€¼ % 12 â†’ æ¢¯åº¦ç´¢å¼•(0-11)
4. **æ¢¯åº¦è·å–**: GRAD3[ç´¢å¼•] â†’ 3Dæ¢¯åº¦å‘é‡
5. **ç‚¹ç§¯è®¡ç®—**: æ¢¯åº¦ Â· ä½ç½®å‘é‡ â†’ è´¡çŒ®å€¼

### 5.3 ä¸ºä»€ä¹ˆéœ€è¦PERMè¡¨ï¼Ÿ

**æ ¸å¿ƒé—®é¢˜ï¼šå¦‚ä½•ä»è§„å¾‹åæ ‡ç”Ÿæˆä¼ªéšæœºæ¢¯åº¦ï¼Ÿ**

**ä¸ä½¿ç”¨PERMè¡¨çš„é—®é¢˜ï¼š**
```c
// é”™è¯¯æ–¹å¼ï¼šç›´æ¥ä½¿ç”¨åæ ‡
int gradient_index = (x + y) % 12;  // äº§ç”Ÿæ˜æ˜¾è§„å¾‹æ€§
```

**ä½¿ç”¨PERMè¡¨çš„ä¼˜åŠ¿ï¼š**
```c
// æ­£ç¡®æ–¹å¼ï¼šé€šè¿‡ç½®æ¢è¡¨æ‰“ç ´è§„å¾‹æ€§
int gradient_index = PERM[x % 256 + PERM[y % 256]] % 12;
```

**æ•ˆæœå¯¹æ¯”ï¼š**
- **æ— PERM**: æ˜æ˜¾çš„ç½‘æ ¼çŠ¶å›¾æ¡ˆï¼Œä¸è‡ªç„¶
- **æœ‰PERM**: ä¼ªéšæœºåˆ†å¸ƒï¼Œè§†è§‰ä¸Šè‡ªç„¶

---

## 6. ç”Ÿç‰©ç¾¤è½ç”Ÿæˆç®—æ³•

```mermaid
graph LR
    A["æ¤ç‰©ç”Ÿæˆç³»ç»Ÿ"] --> B["è‰åœ°ç”Ÿæˆ"]
    A --> C["èŠ±æœµç”Ÿæˆ"]
    A --> D["æ ‘æœ¨ç”Ÿæˆ"]
    A --> E["äº‘æœµç”Ÿæˆ"]
    
    B --> B1["å™ªå£°å‚æ•°:<br/>(-x*0.1, z*0.1, 4, 0.8, 2)"]
    B --> B2["é˜ˆå€¼: > 0.6"]
    B --> B3["è¦†ç›–ç‡: ~15.9%"]
    B --> B4["æ–¹å—ID: 17"]
    
    C --> C1["å™ªå£°å‚æ•°:<br/>(x*0.05, -z*0.05, 4, 0.8, 2)"]
    C --> C2["é˜ˆå€¼: > 0.7"]
    C --> C3["è¦†ç›–ç‡: ~6.7%"]
    C --> C4["æ–¹å—ID: 18-25éšæœº"]
    
    D --> D1["å™ªå£°å‚æ•°:<br/>(x, z, 6, 0.5, 2)"]
    D --> D2["é˜ˆå€¼: > 0.84"]
    D --> D3["è¦†ç›–ç‡: ~1.5%"]
    D --> D4["ç»“æ„: æ ‘å¹²+çƒå½¢æ ‘å† "]
    
    E --> E1["3Då™ªå£°å‚æ•°:<br/>(x*0.01, y*0.1, z*0.01, 8, 0.5, 2)"]
    E --> E2["é«˜åº¦å±‚: 64-72"]
    E --> E3["é˜ˆå€¼: > 0.75"]
    E --> E4["æ–¹å—ID: 16"]
```

### 6.1 æ¤ç‰©ç”Ÿæˆç³»ç»Ÿ

**è‰åœ°ç”Ÿæˆï¼š**
```c
if (simplex2(-x * 0.1, z * 0.1, 4, 0.8, 2) > 0.6) {
    func(x, h, z, 17 * flag, arg);  // TALL_GRASS
}
```

**èŠ±æœµç”Ÿæˆï¼š**
```c
if (simplex2(x * 0.05, -z * 0.05, 4, 0.8, 2) > 0.7) {
    int flower_type = 18 + simplex2(x * 0.1, z * 0.1, 4, 0.8, 2) * 7;
    func(x, h, z, flower_type * flag, arg);
}
```

**å‚æ•°åˆ†æï¼š**

| æ¤ç‰©ç±»å‹ | é¢‘ç‡ç³»æ•° | é˜ˆå€¼ | è¦†ç›–ç‡ | åæ ‡å˜æ¢ |
|----------|----------|------|--------|----------|
| è‰åœ° | 0.1 | 0.6 | ~15.9% | (-x, z) |
| èŠ±æœµ | 0.05 | 0.7 | ~6.7% | (x, -z) |

**è®¾è®¡åŸç†ï¼š**
- **ä¸åŒé¢‘ç‡**: é¿å…æ¤ç‰©åˆ†å¸ƒé‡å 
- **é«˜é˜ˆå€¼**: ç¡®ä¿æ¤ç‰©ç¨€ç–åˆ†å¸ƒ
- **åæ ‡å˜æ¢**: ä¿è¯åˆ†å¸ƒçš„ç‹¬ç«‹æ€§
- **å¤šæ ·æ€§**: èŠ±æœµç±»å‹éšæœºé€‰æ‹©

### 6.2 æ ‘æœ¨ç”Ÿæˆç®—æ³•

**ç”Ÿæˆæ¡ä»¶æ£€æŸ¥ï¼š**
```c
// 1. è¾¹ç•Œæ£€æŸ¥
int ok = SHOW_TREES;
if (dx - 4 < 0 || dz - 4 < 0 || 
    dx + 4 >= CHUNK_SIZE || dz + 4 >= CHUNK_SIZE) {
    ok = 0;  // å¤ªé è¿‘åŒºå—è¾¹ç¼˜
}

// 2. å¯†åº¦æ£€æŸ¥
if (ok && simplex2(x, z, 6, 0.5, 2) > 0.84) {
    // ç”Ÿæˆæ ‘æœ¨
}
```

**æ ‘æœ¨ç»“æ„ç”Ÿæˆï¼š**
```c
// æ ‘å† ç”Ÿæˆ (çƒå½¢åˆ†å¸ƒ)
for (int y = h + 3; y < h + 8; y++) {
    for (int ox = -3; ox <= 3; ox++) {
        for (int oz = -3; oz <= 3; oz++) {
            int d = (ox * ox) + (oz * oz) + (y - (h + 4)) * (y - (h + 4));
            if (d < 11) {  // çƒå½¢åŠå¾„çº¦âˆš11 â‰ˆ 3.3
                func(x + ox, y, z + oz, 15, arg);  // LEAVES
            }
        }
    }
}

// æ ‘å¹²ç”Ÿæˆ (å‚ç›´æŸ±çŠ¶)
for (int y = h; y < h + 7; y++) {
    func(x, y, z, 5, arg);  // WOOD
}
```

**ç”Ÿæˆæ¦‚ç‡è®¡ç®—ï¼š**
- **é˜ˆå€¼0.84**: çº¦15%çš„æ¦‚ç‡
- **è¾¹ç•Œé™åˆ¶**: å®é™…ç”Ÿæˆç‡æ›´ä½
- **åˆç†å¯†åº¦**: é¿å…æ£®æ—è¿‡äºå¯†é›†

### 6.3 äº‘æœµç”Ÿæˆç³»ç»Ÿ

**3Då™ªå£°åº”ç”¨ï¼š**
```c
if (SHOW_CLOUDS) {
    for (int y = 64; y < 72; y++) {
        if (simplex3(x * 0.01, y * 0.1, z * 0.01, 8, 0.5, 2) > 0.75) {
            func(x, y, z, 16 * flag, arg);  // CLOUD
        }
    }
}
```

**å‚æ•°è®¾è®¡ï¼š**
- **é«˜åº¦å±‚**: 64-72æ ¼ï¼Œæ¨¡æ‹ŸçœŸå®äº‘å±‚
- **3Då™ªå£°**: è€ƒè™‘é«˜åº¦ç»´åº¦çš„å˜åŒ–
- **é«˜é˜ˆå€¼**: 0.75ç¡®ä¿äº‘æœµç¨€ç–åˆ†å¸ƒ
- **é¢‘ç‡é…ç½®**: Yè½´é¢‘ç‡æ›´é«˜ï¼Œäº§ç”Ÿå±‚çŠ¶ç»“æ„

---

## 7. è‡ªç„¶æ€§å®ç°åŸç†

### 7.1 åˆ†å½¢å‡ ä½•åŸºç¡€

**è‡ªç›¸ä¼¼æ€§ï¼š**
Craftåœ°å½¢åœ¨ä¸åŒå°ºåº¦ä¸Šå‘ˆç°ç›¸ä¼¼çš„ç»Ÿè®¡ç‰¹æ€§ï¼Œè¿™æ˜¯åˆ†å½¢å‡ ä½•çš„æ ¸å¿ƒç‰¹å¾ã€‚

**å¤šå°ºåº¦å±‚æ¬¡ï¼š**
```c
// octaves=4, lacunarity=2.0 äº§ç”Ÿçš„å°ºåº¦å±‚æ¬¡
Scale 1: 100 blocks   (freq = 0.01)
Scale 2: 50 blocks    (freq = 0.02) 
Scale 3: 25 blocks    (freq = 0.04)
Scale 4: 12.5 blocks  (freq = 0.08)
```

### 7.2 é¢‘è°±ç‰¹æ€§åˆ†æ

**åŠŸç‡è°±å¯†åº¦ï¼š**
è‡ªç„¶åœ°å½¢çš„é¢‘è°±é€šå¸¸éµå¾ªå¹‚å¾‹åˆ†å¸ƒï¼šS(f) âˆ 1/f^Î²

**Craftå‚æ•°é…ç½®ï¼š**
- **persistence = 0.5**: Î² â‰ˆ 2ï¼Œæ¥è¿‘ç²‰çº¢å™ªå£°
- **lacunarity = 2.0**: æ ‡å‡†å€é¢‘å…³ç³»
- **octaves = 4**: è¦†ç›–4ä¸ªå€é¢‘ç¨‹

**ä¸è‡ªç„¶åœ°å½¢å¯¹æ¯”ï¼š**
| ç‰¹å¾ | çœŸå®åœ°å½¢ | Craftåœ°å½¢ | åŒ¹é…åº¦ |
|------|----------|-----------|--------|
| åˆ†å½¢ç»´æ•° | 2.1-2.3 | 2.5 | æ¥è¿‘ |
| é¢‘è°±æ–œç‡ | -1.8 to -2.2 | -2.0 | ä¼˜ç§€ |
| é«˜åº¦åˆ†å¸ƒ | è¿‘ä¼¼æ­£æ€ | åŒå³°åˆ†å¸ƒ | åˆç† |
| ç©ºé—´ç›¸å…³ | é•¿ç¨‹ç›¸å…³ | é•¿ç¨‹ç›¸å…³ | åŒ¹é… |

### 7.3 è®¤çŸ¥ç§‘å­¦åŸç†

**äººç±»è§†è§‰æ„ŸçŸ¥ï¼š**
1. **å¤šå°ºåº¦æ•æ„Ÿæ€§**: äººçœ¼å¯¹ä¸åŒå°ºåº¦çš„ç»†èŠ‚éƒ½æ•æ„Ÿ
2. **1/få™ªå£°åå¥½**: å¤§è„‘æ›´åçˆ±å…·æœ‰1/fç‰¹æ€§çš„å›¾åƒ
3. **åˆ†å½¢ç¾å­¦**: åˆ†å½¢å›¾æ¡ˆå…·æœ‰å¤©ç„¶çš„ç¾æ„Ÿ
4. **ç©ºé—´é¢‘ç‡å“åº”**: è§†è§‰çš®å±‚å¯¹ç‰¹å®šé¢‘ç‡æ•æ„Ÿ

**Craftçš„è®¤çŸ¥ä¼˜åŒ–ï¼š**
- **4ä¸ªoctave**: è¦†ç›–äººç±»è§†è§‰çš„æ•æ„Ÿé¢‘æ®µ
- **persistence=0.5**: äº§ç”Ÿè§†è§‰ä¸Šèˆ’é€‚çš„å¯¹æ¯”åº¦
- **å¹³æ»‘è¿‡æ¸¡**: é¿å…è§†è§‰ä¸Šçš„çªå…€æ„Ÿ

---

## 8. ç³»ç»Ÿå‚æ•°è°ƒä¼˜

### 8.1 åœ°å½¢å‚æ•°ä¼˜åŒ–æŒ‡å—

```mermaid
graph TD
    A["å™ªå£°å‚æ•°å¯¹åœ°å½¢çš„å½±å“"] --> B["Octavesæ•°é‡"]
    A --> C["Persistenceå€¼"]
    A --> D["Lacunarityå€¼"]
    A --> E["åŸºç¡€é¢‘ç‡"]
    
    B --> B1["1å±‚: åŸºç¡€å½¢çŠ¶<br/>æ€§èƒ½æœ€ä½³"]
    B --> B2["2å±‚: ç²—ç•¥ç»†èŠ‚<br/>æ€§èƒ½è‰¯å¥½"]
    B --> B3["4å±‚: ä¸°å¯Œç»†èŠ‚<br/>æ¨èé…ç½®"]
    B --> B4["8å±‚: ç²¾ç»†ç»†èŠ‚<br/>æ€§èƒ½è¾ƒå·®"]
    
    C --> C1["0.3: éå¸¸å¹³æ»‘<br/>å¤§åŠ¿æ˜æ˜¾"]
    C --> C2["0.5: å¹³è¡¡é€‰æ‹©<br/>è‡ªç„¶èµ·ä¼"]
    C --> C3["0.7: è¾ƒä¸ºç²—ç³™<br/>ç»†èŠ‚ä¸°å¯Œ"]
    C --> C4["0.9: éå¸¸ç²—ç³™<br/>å™ªç‚¹æ„Ÿå¼º"]
    
    D --> D1["1.5: é¢‘ç‡å¢é•¿æ…¢<br/>å±‚æ¬¡ä¸æ˜æ˜¾"]
    D --> D2["2.0: æ ‡å‡†é…ç½®<br/>å±‚æ¬¡æ¸…æ™°"]
    D --> D3["3.0: é¢‘ç‡å¢é•¿å¿«<br/>å±‚æ¬¡è·³è·ƒå¤§"]
    
    E --> E1["0.005: å¤§é™†çº§<br/>200æ ¼ç‰¹å¾"]
    E --> E2["0.01: åŒºåŸŸçº§<br/>100æ ¼ç‰¹å¾"]
    E --> E3["0.02: å±€éƒ¨çº§<br/>50æ ¼ç‰¹å¾"]
    E --> E4["0.05: å¾®è§‚çº§<br/>20æ ¼ç‰¹å¾"]
    
    style B3 fill:#c8e6c9
    style C2 fill:#c8e6c9
    style D2 fill:#c8e6c9
    style E2 fill:#c8e6c9
```

**åŸºç¡€é¢‘ç‡é€‰æ‹©ï¼š**
```c
// æ¨èé…ç½®
float base_freq = 0.01;  // 100æ ¼ç‰¹å¾å°ºå¯¸

// æ•ˆæœå¯¹æ¯”
0.005: 200æ ¼ç‰¹å¾ - å¤§é™†çº§åœ°è²Œ
0.01:  100æ ¼ç‰¹å¾ - åŒºåŸŸçº§åœ°è²Œ  [æ¨è]
0.02:  50æ ¼ç‰¹å¾  - å±€éƒ¨çº§åœ°è²Œ
0.05:  20æ ¼ç‰¹å¾  - å¾®è§‚çº§åœ°è²Œ
```

**Octaveæ•°é‡é€‰æ‹©ï¼š**
```c
// æ€§èƒ½vsè´¨é‡æƒè¡¡
1 octave:  åŸºç¡€å½¢çŠ¶ï¼Œæ€§èƒ½æœ€ä½³
2 octaves: ç²—ç•¥ç»†èŠ‚ï¼Œæ€§èƒ½è‰¯å¥½
4 octaves: ä¸°å¯Œç»†èŠ‚ï¼Œå¹³è¡¡é€‰æ‹©  [æ¨è]
6 octaves: ç²¾ç»†ç»†èŠ‚ï¼Œæ€§èƒ½è¾ƒå·®
8 octaves: è¶…ç²¾ç»†ï¼Œæ€§èƒ½å¾ˆå·®
```

**Persistenceè°ƒä¼˜ï¼š**
```c
// åœ°å½¢ç‰¹å¾æ§åˆ¶
0.3: éå¸¸å¹³æ»‘ï¼Œå±±å·å¤§åŠ¿æ˜æ˜¾
0.5: å¹³è¡¡é€‰æ‹©ï¼Œè‡ªç„¶èµ·ä¼  [æ¨è]
0.7: è¾ƒä¸ºç²—ç³™ï¼Œç»†èŠ‚ä¸°å¯Œ
0.9: éå¸¸ç²—ç³™ï¼Œå™ªç‚¹æ„Ÿå¼º
```

### 8.2 ç”Ÿç‰©ç¾¤è½å‚æ•°è°ƒä¼˜

**æ¤ç‰©å¯†åº¦æ§åˆ¶ï¼š**
```c
// é˜ˆå€¼ä¸è¦†ç›–ç‡çš„å…³ç³»
threshold = 0.5 â†’ coverage â‰ˆ 30.9%
threshold = 0.6 â†’ coverage â‰ˆ 15.9%  [è‰åœ°æ¨è]
threshold = 0.7 â†’ coverage â‰ˆ 6.7%   [èŠ±æœµæ¨è]
threshold = 0.8 â†’ coverage â‰ˆ 2.3%
threshold = 0.9 â†’ coverage â‰ˆ 0.6%
```

**æ ‘æœ¨å¯†åº¦è°ƒä¼˜ï¼š**
```c
// å»ºè®®é…ç½®
simplex2(x, z, 6, 0.5, 2) > 0.84    // ç¨€ç–æ£®æ—
simplex2(x, z, 6, 0.5, 2) > 0.80    // ä¸­ç­‰æ£®æ—  
simplex2(x, z, 6, 0.5, 2) > 0.75    // å¯†é›†æ£®æ—
```

### 8.3 æ€§èƒ½ä¼˜åŒ–å‚æ•°

**åŒºå—ç®¡ç†ï¼š**
```c
// config.h æ¨èé…ç½®
#define CREATE_CHUNK_RADIUS 10   // åˆ›å»ºåŠå¾„
#define RENDER_CHUNK_RADIUS 10   // æ¸²æŸ“åŠå¾„  
#define DELETE_CHUNK_RADIUS 14   // åˆ é™¤åŠå¾„
#define CHUNK_SIZE 32            // åŒºå—å¤§å°
```

**å™ªå£°è®¡ç®—ä¼˜åŒ–ï¼š**
```c
// é¢‘ç‡é¢„è®¡ç®—
float freq_table[MAX_OCTAVES];
for (int i = 0; i < octaves; i++) {
    freq_table[i] = base_freq * pow(lacunarity, i);
}

// æŒ¯å¹…é¢„è®¡ç®—  
float amp_table[MAX_OCTAVES];
for (int i = 0; i < octaves; i++) {
    amp_table[i] = pow(persistence, i);
}
```

---

## 9. åœ°å½¢ä¿®æ”¹ä¸å®šåˆ¶

### 9.1 å®ç°å¹³å¦åœ°å›¾

```mermaid
flowchart TD
    A["åœ°å½¢ä¿®æ”¹æ–¹æ³•"] --> B["å¹³å¦åœ°å›¾å®ç°"]
    A --> C["è‡ªå®šä¹‰åœ°å½¢ç±»å‹"]
    A --> D["ç”Ÿç‰©ç¾¤è½å®šåˆ¶"]
    
    B --> B1["æ–¹æ³•1: é…ç½®åŒ–æ§åˆ¶<br/>ä¿®æ”¹config.hä¸­TERRAIN_MODE"]
    B --> B2["æ–¹æ³•2: ç›´æ¥é«˜åº¦è®¾å®š<br/>åœ¨world.cä¸­å›ºå®šhå€¼"]
    B --> B3["æ–¹æ³•3: å¹³å¦å™ªå£°å‡½æ•°<br/>return 0.5å›ºå®šå€¼"]
    
    C --> C1["å±±è„‰åœ°å½¢<br/>å¢å¤§é¢‘ç‡ç³»æ•°å’Œé«˜åº¦èŒƒå›´"]
    C --> C2["å²›å±¿åœ°å½¢<br/>æ·»åŠ å¾„å‘è¡°å‡å‡½æ•°"]
    C --> C3["å³¡è°·åœ°å½¢<br/>åŸºäºè·ç¦»çš„æ·±åº¦è®¡ç®—"]
    
    D --> D1["æ²™æ¼ ç¾¤è½<br/>ä»™äººæŒ+å¹²è‰ç”Ÿæˆ"]
    D --> D2["é›ªåœ°ç¾¤è½<br/>é›ªå±‚+äº‘æ‰æ ‘ç”Ÿæˆ"]
    D --> D3["æ£®æ—ç¾¤è½<br/>å¯†é›†æ ‘æœ¨+è˜‘è‡ç”Ÿæˆ"]
    
    style B1 fill:#e8f5e8
    style C2 fill:#e3f2fd
    style D1 fill:#fff3e0
```

**é—®é¢˜åˆ†æï¼š**
å•çº¯ä¿®æ”¹seedæ— æ³•å®ç°å¹³å¦åœ°å›¾ï¼Œå› ä¸ºsimplex2å‡½æ•°æ€»ä¼šäº§ç”Ÿ[0,1]èŒƒå›´çš„å˜åŒ–ã€‚

**è§£å†³æ–¹æ¡ˆ1ï¼šé…ç½®åŒ–æ§åˆ¶**
```c
// config.h
#define TERRAIN_MODE 0       // 0=æ­£å¸¸, 1=å¹³å¦, 2=è¶…å¹³å¦
#define FLAT_HEIGHT 20       // å¹³å¦åœ°å½¢é«˜åº¦
#define SUPER_FLAT_HEIGHT 4  // è¶…å¹³å¦é«˜åº¦

// world.cä¿®æ”¹
void create_world(int p, int q, world_func func, void *arg) {
    for (int dx = -pad; dx < CHUNK_SIZE + pad; dx++) {
        for (int dz = -pad; dz < CHUNK_SIZE + pad; dz++) {
            int x = p * CHUNK_SIZE + dx;
            int z = q * CHUNK_SIZE + dz;
            
#if TERRAIN_MODE == 1
            // å¹³å¦æ¨¡å¼
            int h = FLAT_HEIGHT;
            int w = 1;  // è‰æ–¹å—
#elif TERRAIN_MODE == 2  
            // è¶…å¹³å¦æ¨¡å¼
            int h = SUPER_FLAT_HEIGHT;
            int w = 1;
#else
            // æ­£å¸¸æ¨¡å¼
            float f = simplex2(x * 0.01, z * 0.01, 4, 0.5, 2);
            float g = simplex2(-x * 0.01, -z * 0.01, 2, 0.9, 2);
            int mh = g * 32 + 16;
            int h = f * mh;
            int w = 1;
            int t = 12;
            if (h <= t) {
                h = t;
                w = 2;
            }
#endif
            
            // ç”Ÿæˆåœ°å½¢
            for (int y = 0; y < h; y++) {
                func(x, y, z, w * flag, arg);
            }
        }
    }
}
```

### 9.2 è‡ªå®šä¹‰åœ°å½¢ç±»å‹

**å±±è„‰åœ°å½¢ï¼š**
```c
// å¢åŠ å±±è„‰çš„é«˜åº¦å’Œé™¡å³­åº¦
float f = simplex2(x * 0.005, z * 0.005, 6, 0.7, 2);  // æ›´å¤§å°ºåº¦
float g = simplex2(-x * 0.01, -z * 0.01, 2, 0.9, 2);
int mh = g * 64 + 32;  // æ›´é«˜çš„æœ€å¤§é«˜åº¦ [32, 96]
int h = f * mh;
```

**å²›å±¿åœ°å½¢ï¼š**
```c
// æ·»åŠ å¾„å‘è¡°å‡å‡½æ•°
float center_x = 0, center_z = 0;  // å²›å±¿ä¸­å¿ƒ
float radius = 1000;  // å²›å±¿åŠå¾„
float distance = sqrt((x - center_x) * (x - center_x) + 
                      (z - center_z) * (z - center_z));
float radial_falloff = MAX(0, 1 - distance / radius);

float f = simplex2(x * 0.01, z * 0.01, 4, 0.5, 2);
float g = simplex2(-x * 0.01, -z * 0.01, 2, 0.9, 2);
int mh = (g * 32 + 16) * radial_falloff;  // åº”ç”¨å¾„å‘è¡°å‡
int h = f * mh;
```

### 9.3 ç”Ÿç‰©ç¾¤è½å®šåˆ¶

**æ²™æ¼ ç”Ÿç‰©ç¾¤è½ï¼š**
```c
if (w == 2) {  // æ²™åœ°
    // ä»™äººæŒç”Ÿæˆ
    if (simplex2(x * 0.03, z * 0.03, 4, 0.8, 2) > 0.85) {
        for (int y = h; y < h + 3; y++) {
            func(x, y, z, CACTUS_BLOCK, arg);
        }
    }
    // å¹²è‰ç”Ÿæˆ
    if (simplex2(-x * 0.08, z * 0.08, 4, 0.8, 2) > 0.75) {
        func(x, h, z, DRY_GRASS_BLOCK, arg);
    }
}
```

**é›ªåœ°ç”Ÿç‰©ç¾¤è½ï¼š**
```c
if (h > 35) {  // é«˜æµ·æ‹”åœ°åŒº
    // é›ªå±‚è¦†ç›–
    func(x, h, z, SNOW_BLOCK, arg);
    
    // äº‘æ‰æ ‘ç”Ÿæˆ
    if (simplex2(x * 0.02, z * 0.02, 6, 0.5, 2) > 0.88) {
        generate_spruce_tree(x, h, z, func, arg);
    }
}
```

---

## 10. æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

```mermaid
graph TD
    A["æ€§èƒ½ä¼˜åŒ–ç­–ç•¥"] --> B["å™ªå£°è®¡ç®—ä¼˜åŒ–"]
    A --> C["å†…å­˜ç®¡ç†ä¼˜åŒ–"]
    A --> D["å¤šçº¿ç¨‹å¹¶è¡ŒåŒ–"]
    
    B --> B1["æŸ¥æ‰¾è¡¨é¢„è®¡ç®—<br/>sin/cos, é¢‘ç‡, æŒ¯å¹…"]
    B --> B2["SIMDæŒ‡ä»¤é›†<br/>AVX2å¹¶è¡Œè®¡ç®—"]
    B --> B3["GPUè®¡ç®—<br/>CUDA/OpenCLåŠ é€Ÿ"]
    
    C --> C1["LRUåŒºå—ç¼“å­˜<br/>æ™ºèƒ½æ¢é¡µæœºåˆ¶"]
    C --> C2["å†…å­˜æ± åˆ†é…<br/>é¿å…é¢‘ç¹malloc"]
    C --> C3["æ•°æ®å‹ç¼©<br/>å‡å°‘å†…å­˜å ç”¨"]
    
    D --> D1["å·¥ä½œçº¿ç¨‹æ± <br/>å¼‚æ­¥åŒºå—ç”Ÿæˆ"]
    D --> D2["ç”Ÿäº§è€…æ¶ˆè´¹è€…<br/>è§£è€¦è®¡ç®—å’Œæ¸²æŸ“"]
    D --> D3["ä»»åŠ¡ä¼˜å…ˆçº§<br/>ç©å®¶è§†é‡å†…ä¼˜å…ˆ"]
    
    E["æ€§èƒ½æŒ‡æ ‡"] --> F["ç›®æ ‡æ€§èƒ½"]
    F --> F1["åŒºå—ç”Ÿæˆ: <10ms"]
    F --> F2["å†…å­˜ä½¿ç”¨: <512MB"]
    F --> F3["CPUå ç”¨: <30%"]
    F --> F4["å¸§ç‡ç¨³å®š: >60FPS"]
```

### 10.1 å™ªå£°è®¡ç®—ä¼˜åŒ–

**æŸ¥æ‰¾è¡¨ä¼˜åŒ–ï¼š**
```c
// é¢„è®¡ç®—sin/cosæŸ¥æ‰¾è¡¨
static float sin_table[360];
static float cos_table[360];

void init_trig_tables() {
    for (int i = 0; i < 360; i++) {
        sin_table[i] = sin(i * PI / 180.0);
        cos_table[i] = cos(i * PI / 180.0);
    }
}
```

**SIMDä¼˜åŒ–ï¼ˆä¼ªä»£ç ï¼‰ï¼š**
```c
// ä½¿ç”¨SIMDæŒ‡ä»¤å¹¶è¡Œè®¡ç®—å¤šä¸ªå™ªå£°å€¼
#include <immintrin.h>

void compute_noise_batch_avx2(float* x_array, float* y_array, 
                               float* result, int count) {
    for (int i = 0; i < count; i += 8) {
        __m256 x = _mm256_load_ps(&x_array[i]);
        __m256 y = _mm256_load_ps(&y_array[i]);
        __m256 noise = _mm256_simplex2_ps(x, y);  // è‡ªå®ç°
        _mm256_store_ps(&result[i], noise);
    }
}
```

### 10.2 å†…å­˜ç®¡ç†ä¼˜åŒ–

**åŒºå—ç¼“å­˜ç­–ç•¥ï¼š**
```c
// LRUç¼“å­˜å®ç°
typedef struct ChunkCache {
    Chunk* chunks;
    int* access_time;
    int capacity;
    int current_time;
} ChunkCache;

void cache_access_chunk(ChunkCache* cache, int p, int q) {
    int index = find_chunk_index(cache, p, q);
    if (index >= 0) {
        cache->access_time[index] = cache->current_time++;
    } else {
        evict_lru_chunk(cache);
        load_new_chunk(cache, p, q);
    }
}
```

**å†…å­˜æ± åˆ†é…ï¼š**
```c
// é¢„åˆ†é…å†…å­˜æ± é¿å…é¢‘ç¹malloc/free
typedef struct MemoryPool {
    char* memory;
    size_t size;
    size_t offset;
} MemoryPool;

void* pool_alloc(MemoryPool* pool, size_t size) {
    if (pool->offset + size <= pool->size) {
        void* ptr = pool->memory + pool->offset;
        pool->offset += size;
        return ptr;
    }
    return NULL;  // æ± æ»¡ï¼Œéœ€è¦æ¸…ç†
}
```

### 10.3 å¤šçº¿ç¨‹å¹¶è¡ŒåŒ–

**å·¥ä½œçº¿ç¨‹æ¨¡å‹ï¼š**
```c
typedef struct WorkerThread {
    int id;
    Queue* work_queue;
    mtx_t queue_mutex;
    cnd_t work_available;
    bool running;
} WorkerThread;

int worker_thread_func(void* arg) {
    WorkerThread* worker = (WorkerThread*)arg;
    
    while (worker->running) {
        WorkItem* item = dequeue_work(worker);
        if (item) {
            switch (item->type) {
                case GENERATE_CHUNK:
                    generate_chunk_async(item);
                    break;
                case COMPUTE_LIGHTING:
                    compute_lighting_async(item);
                    break;
            }
            complete_work(item);
        }
    }
    return 0;
}
```

---

## 11. å®è·µåº”ç”¨æ¡ˆä¾‹

### 11.1 æœåŠ¡å™¨é…ç½®ç¤ºä¾‹

**é«˜æ€§èƒ½æœåŠ¡å™¨é…ç½®ï¼š**
```python
# server.py ä¼˜åŒ–é…ç½®
class OptimizedModel(Model):
    def __init__(self, seed=None):
        super().__init__(seed)
        self.chunk_cache_size = 1000  # å¢å¤§ç¼“å­˜
        self.pregenerate_radius = 5   # é¢„ç”ŸæˆåŠå¾„
        self.compression_enabled = True
        
    def start(self):
        # å¯åŠ¨å¤šä¸ªå·¥ä½œçº¿ç¨‹
        self.workers = []
        for i in range(cpu_count()):
            worker = ChunkGenerationWorker()
            worker.start()
            self.workers.append(worker)
        super().start()
```

**å†…å­˜ä¼˜åŒ–é…ç½®ï¼š**
```c
// config.h å†…å­˜ä¼˜åŒ–
#define CHUNK_SIZE 16           // å‡å°åŒºå—å¤§å°
#define CREATE_CHUNK_RADIUS 8   // å‡å°åˆ›å»ºåŠå¾„
#define MAX_CHUNKS 500          // é™åˆ¶æœ€å¤§åŒºå—æ•°
#define USE_COMPRESSION 1       // å¯ç”¨å‹ç¼©
```

### 11.2 ç‰¹æ®Šåœ°å›¾ç”Ÿæˆ

**ç¾¤å²›åœ°å›¾ç”Ÿæˆå™¨ï¼š**
```c
float generate_archipelago_height(int x, int z) {
    // å¤šä¸ªå²›å±¿ä¸­å¿ƒ
    float islands[] = {
        {0, 0, 800},      // ä¸»å²›
        {1200, 800, 400}, // åŒ—å²›  
        {-800, 1000, 300} // è¥¿å²›
    };
    
    float max_height = 0;
    for (int i = 0; i < 3; i++) {
        float dx = x - islands[i].x;
        float dz = z - islands[i].z;
        float distance = sqrt(dx*dx + dz*dz);
        float falloff = MAX(0, 1 - distance / islands[i].radius);
        
        if (falloff > 0) {
            float noise = simplex2(x * 0.01, z * 0.01, 4, 0.5, 2);
            float island_height = noise * 40 * falloff + 15;
            max_height = MAX(max_height, island_height);
        }
    }
    
    return max_height;
}
```

**å³¡è°·åœ°å½¢ç”Ÿæˆå™¨ï¼š**
```c
float generate_canyon_height(int x, int z) {
    // åŸºç¡€åœ°å½¢
    float base_height = simplex2(x * 0.005, z * 0.005, 4, 0.5, 2) * 30 + 20;
    
    // æ²³æµè·¯å¾„ï¼ˆä½¿ç”¨å¤šæ¡æ›²çº¿ï¼‰
    float river_curves[] = {
        sin(x * 0.001) * 200 + z,     // ä¸»æ²³é“
        sin(x * 0.002 + 100) * 150 + z - 500  // æ”¯æµ
    };
    
    float min_distance = INFINITY;
    for (int i = 0; i < 2; i++) {
        float distance = fabs(river_curves[i]);
        min_distance = MIN(min_distance, distance);
    }
    
    // å³¡è°·æ·±åº¦
    float canyon_depth = MAX(0, 30 - min_distance * 0.1);
    canyon_depth *= simplex2(x * 0.02, z * 0.02, 3, 0.6, 2); // æ·»åŠ ç²—ç³™åº¦
    
    return base_height - canyon_depth;
}
```

### 11.3 è°ƒè¯•å·¥å…·å®ç°

**åœ°å½¢é¢„è§ˆå™¨ï¼š**
```c
void generate_height_map_image(const char* filename, int width, int height) {
    unsigned char* image = malloc(width * height * 3);
    
    for (int y = 0; y < height; y++) {
        for (int x = 0; x < width; x++) {
            float world_x = (x - width/2) * 4.0;   // ç¼©æ”¾åˆ°ä¸–ç•Œåæ ‡
            float world_z = (y - height/2) * 4.0;
            
            float f = simplex2(world_x * 0.01, world_z * 0.01, 4, 0.5, 2);
            float g = simplex2(-world_x * 0.01, -world_z * 0.01, 2, 0.9, 2);
            int h = f * (g * 32 + 16);
            
            // é«˜åº¦æ˜ å°„åˆ°é¢œè‰²
            unsigned char color = (h * 255) / 64;  // å‡è®¾æœ€å¤§é«˜åº¦64
            
            int idx = (y * width + x) * 3;
            if (h <= 12) {
                // æµ·æ´‹ - è“è‰²
                image[idx] = 0;
                image[idx + 1] = 0;
                image[idx + 2] = 255;
            } else {
                // é™†åœ° - ç»¿åˆ°ç™½æ¸å˜
                image[idx] = color/2;
                image[idx + 1] = color;
                image[idx + 2] = color/2;
            }
        }
    }
    
    save_png_image(filename, image, width, height);
    free(image);
}
```

**æ€§èƒ½åˆ†æå™¨ï¼š**
```c
typedef struct ProfilerData {
    double noise_computation_time;
    double terrain_generation_time;
    double plant_generation_time;
    int chunks_generated;
    int noise_calls;
} ProfilerData;

void profile_chunk_generation() {
    ProfilerData data = {0};
    double start_time = get_time();
    
    // ç”Ÿæˆæµ‹è¯•åŒºå—
    for (int p = 0; p < 10; p++) {
        for (int q = 0; q < 10; q++) {
            double chunk_start = get_time();
            create_world(p, q, test_world_func, &data);
            data.terrain_generation_time += get_time() - chunk_start;
            data.chunks_generated++;
        }
    }
    
    double total_time = get_time() - start_time;
    
    printf("Performance Report:\n");
    printf("Total time: %.2f ms\n", total_time * 1000);
    printf("Average time per chunk: %.2f ms\n", 
           (data.terrain_generation_time / data.chunks_generated) * 1000);
    printf("Noise calls: %d\n", data.noise_calls);
    printf("Chunks generated: %d\n", data.chunks_generated);
}
```

---

## 12. æ€»ç»“ä¸å±•æœ›

### 12.1 ç³»ç»Ÿä¼˜åŠ¿

**æŠ€æœ¯ä¼˜åŠ¿ï¼š**
1. **æ•°å­¦åŸºç¡€æ‰å®**: åŸºäºç»å…¸Simplexå™ªå£°ç®—æ³•
2. **å‚æ•°åŒ–è®¾è®¡**: é«˜åº¦å¯é…ç½®å’Œå¯è°ƒä¼˜
3. **æ€§èƒ½å‹å¥½**: å®æ—¶ç”Ÿæˆèƒ½åŠ›
4. **ç¡®å®šæ€§è¾“å‡º**: ç›¸åŒç§å­äº§ç”Ÿç›¸åŒç»“æœ
5. **è‡ªç„¶æ€§å¼º**: ç¬¦åˆåˆ†å½¢å‡ ä½•å’Œè®¤çŸ¥ç§‘å­¦åŸç†

**å®ç”¨ä¼˜åŠ¿ï¼š**
1. **æ— é™ä¸–ç•Œ**: æ”¯æŒæ— é™æ‰©å±•çš„ä¸–ç•Œå¤§å°
2. **å¤šæ ·åŒ–åœ°å½¢**: æµ·æ´‹ã€å¹³åŸã€ä¸˜é™µã€å±±åœ°ç­‰
3. **ä¸°å¯Œç”Ÿæ€**: æ¤ç‰©ã€æ ‘æœ¨ã€äº‘æœµç­‰è‡ªç„¶è¦ç´ 
4. **æ˜“äºä¿®æ”¹**: ä»£ç ç»“æ„æ¸…æ™°ï¼Œä¾¿äºå®šåˆ¶

### 12.2 æ”¹è¿›æ–¹å‘

**çŸ­æœŸæ”¹è¿›ï¼š**
1. **ç”Ÿç‰©ç¾¤è½ç³»ç»Ÿ**: å®ç°æ›´å¤æ‚çš„ç”Ÿç‰©ç¾¤è½åˆ’åˆ†
2. **åœ°è´¨ç»“æ„**: æ·»åŠ æ´ç©´ã€çŸ¿ç‰©åˆ†å¸ƒç­‰
3. **æ°”å€™æ¨¡æ‹Ÿ**: åŸºäºåœ°ç†ä½ç½®çš„æ°”å€™å˜åŒ–
4. **æ€§èƒ½ä¼˜åŒ–**: SIMDæŒ‡ä»¤é›†ã€GPUè®¡ç®—ç­‰

**é•¿æœŸå±•æœ›ï¼š**
1. **æœºå™¨å­¦ä¹ **: ä½¿ç”¨ç¥ç»ç½‘ç»œä¼˜åŒ–åœ°å½¢è‡ªç„¶æ€§
2. **ç‰©ç†æ¨¡æ‹Ÿ**: åŠ å…¥ä¾µèš€ã€æ²‰ç§¯ç­‰åœ°è´¨è¿‡ç¨‹
3. **ç”Ÿæ€ç³»ç»Ÿ**: åŠ¨æ€çš„ç”Ÿæ€å¹³è¡¡å’Œæ¼”åŒ–
4. **ç”¨æˆ·ç”Ÿæˆ**: æ”¯æŒç”¨æˆ·è‡ªå®šä¹‰åœ°å½¢è§„åˆ™

### 12.3 å­¦ä¹ ä»·å€¼

**å¯¹å¼€å‘è€…çš„ä»·å€¼ï¼š**
1. **å™ªå£°å‡½æ•°ç†è§£**: æ·±å…¥ç†è§£ç¨‹åºåŒ–å†…å®¹ç”Ÿæˆ
2. **æ•°å­¦åº”ç”¨**: åˆ†å½¢å‡ ä½•åœ¨æ¸¸æˆå¼€å‘ä¸­çš„åº”ç”¨
3. **æ€§èƒ½ä¼˜åŒ–**: å®æ—¶ç”Ÿæˆçš„ä¼˜åŒ–ç­–ç•¥
4. **ç³»ç»Ÿè®¾è®¡**: å¤§å‹ç³»ç»Ÿçš„æ¨¡å—åŒ–è®¾è®¡

**å¯¹ç ”ç©¶çš„ä»·å€¼ï¼š**
1. **ç¨‹åºåŒ–ç”Ÿæˆ**: ä¸ºç›¸å…³ç ”ç©¶æä¾›å®è·µæ¡ˆä¾‹
2. **è®¤çŸ¥ç§‘å­¦**: éªŒè¯ç¾å­¦æ„ŸçŸ¥çš„æ•°å­¦æ¨¡å‹
3. **è®¡ç®—å‡ ä½•**: é«˜ç»´å™ªå£°å‡½æ•°çš„å®é™…åº”ç”¨

---

## 13. å‚è€ƒèµ„æº

### 13.1 æŠ€æœ¯æ–‡æ¡£
- [Ken Perlin's Noise Functions](http://mrl.nyu.edu/~perlin/noise/)
- [Casey Duncan's Python Noise Library](https://github.com/caseman/noise)
- [Stefan Gustavson's Simplex Noise Demystified](http://staffwww.itn.liu.se/~stegu/simplexnoise/simplexnoise.pdf)

### 13.2 æ•°å­¦å‚è€ƒ
- **åˆ†å½¢å‡ ä½•å­¦**: Benoit Mandelbrotè‘—
- **è®¡ç®—æœºå›¾å½¢å­¦**: ç¨‹åºåŒ–å†…å®¹ç”Ÿæˆç« èŠ‚
- **ä¿¡å·å¤„ç†**: é¢‘è°±åˆ†æå’Œæ»¤æ³¢å™¨è®¾è®¡

### 13.3 å¼€å‘èµ„æº
- [Crafté¡¹ç›®æºç ](https://github.com/fogleman/Craft)
- [OpenGLå®˜æ–¹æ–‡æ¡£](https://www.opengl.org/documentation/)
- [GLFWçª—å£ç®¡ç†åº“](https://www.glfw.org/)

---

*æœ¬æ–‡æ¡£åŸºäºCrafté¡¹ç›®æºç æ·±å…¥åˆ†æç¼–å†™ï¼Œæ¶µç›–äº†åœ°å½¢ç”Ÿæˆç³»ç»Ÿçš„å®Œæ•´æŠ€æœ¯ç»†èŠ‚ã€‚å¸Œæœ›èƒ½ä¸ºç†è§£ç¨‹åºåŒ–å†…å®¹ç”Ÿæˆæä¾›æœ‰ä»·å€¼çš„å‚è€ƒã€‚*

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**æœ€åæ›´æ–°**: 2024å¹´12æœˆ  
**ä½œè€…**: AI Assistant  
**æˆæƒ**: å¼€æºå…±äº«
